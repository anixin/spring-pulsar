<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PulsarProducerBuilder.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Spring Pulsar Core</a> &gt; <a href="index.source.html" class="el_package">com.intuit.spring.pulsar.client.producer</a> &gt; <span class="el_source">PulsarProducerBuilder.kt</span></div><h1>PulsarProducerBuilder.kt</h1><pre class="source lang-java linenums">package com.intuit.spring.pulsar.client.producer

import com.intuit.spring.pulsar.client.config.PulsarProducerBatchingConfig
import com.intuit.spring.pulsar.client.config.PulsarProducerConfig
import com.intuit.spring.pulsar.client.config.PulsarProducerMessageConfig
import org.apache.pulsar.client.api.ProducerBuilder
import org.apache.pulsar.client.api.PulsarClient
import org.apache.pulsar.client.api.Schema
import java.util.concurrent.TimeUnit

/**
 * Builder class to build producer object from
 * configuration.
 */
<span class="pc" id="L15">class PulsarProducerBuilder&lt;T&gt;(pulsarClient: PulsarClient, val schema: Schema&lt;T&gt;) {</span>

<span class="fc" id="L17">    private val builder: ProducerBuilder&lt;T&gt; = pulsarClient.newProducer(schema)</span>
<span class="fc" id="L18">    private var autoFlush: Boolean = true</span>

    /**
     * Populate builder with producer config
     */
    fun withProducerConfig(producer: PulsarProducerConfig&lt;T&gt;): PulsarProducerBuilder&lt;T&gt; {
<span class="fc" id="L24">        producer.let {</span>
<span class="fc" id="L25">            producer.topicName.let { builder.topic(producer.topicName) }</span>
<span class="fc bfc" id="L26" title="All 2 branches covered.">            producer.blockIfQueueFull</span>
<span class="fc" id="L27">                ?.let { builder.blockIfQueueFull(producer.blockIfQueueFull) }</span>
<span class="fc bfc" id="L28" title="All 2 branches covered.">            producer.cryptoFailureAction</span>
<span class="fc" id="L29">                ?.let { builder.cryptoFailureAction(producer.cryptoFailureAction) }</span>
<span class="fc bfc" id="L30" title="All 2 branches covered.">            producer.sendTimeout</span>
<span class="fc" id="L31">                ?.let { builder.sendTimeout(producer.sendTimeout.toSeconds().toInt(), TimeUnit.SECONDS) }</span>
<span class="fc" id="L32">            producer.autoFlush.let {</span>
<span class="fc" id="L33">                autoFlush = producer.autoFlush</span>
<span class="fc" id="L34">            }</span>
<span class="fc" id="L35">            withBatchConfig(producer.batch)</span>
<span class="fc" id="L36">            withMessageConfig(producer.message)</span>
        }
<span class="fc" id="L38">        return this</span>
    }

    /**
     * Populate builder with producer batch  config
     */
    fun withBatchConfig(batch: PulsarProducerBatchingConfig): PulsarProducerBuilder&lt;T&gt; {
<span class="fc bfc" id="L45" title="All 2 branches covered.">        batch.batchingEnabled?.let { builder.enableBatching(batch.batchingEnabled) }</span>
<span class="fc bfc" id="L46" title="All 2 branches covered.">        batch.batchingMaxMessages</span>
<span class="fc" id="L47">            ?.let { builder.batchingMaxMessages(batch.batchingMaxMessages) }</span>
<span class="fc bfc" id="L48" title="All 2 branches covered.">        batch.batchingMaxPublishDelayMicros?.let {</span>
<span class="fc" id="L49">            builder.batchingMaxPublishDelay(</span>
<span class="fc" id="L50">                batch.batchingMaxPublishDelayMicros,</span>
<span class="fc" id="L51">                TimeUnit.MICROSECONDS</span>
            )
        }
<span class="fc" id="L54">        return this</span>
    }

    /**
     * Populate builder with producer message  config
     */
    fun withMessageConfig(message: PulsarProducerMessageConfig): PulsarProducerBuilder&lt;T&gt; {
<span class="fc bfc" id="L61" title="All 2 branches covered.">        message.messageRoutingMode</span>
<span class="fc" id="L62">            ?.let { builder.messageRoutingMode(message.messageRoutingMode) }</span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">        message.compressionType?.let { builder.compressionType(message.compressionType) }</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">        message.hashingScheme?.let { builder.hashingScheme(message.hashingScheme) }</span>
<span class="fc bfc" id="L65" title="All 2 branches covered.">        message.maxPendingMessages</span>
<span class="fc" id="L66">            ?.let { builder.maxPendingMessages(message.maxPendingMessages) }</span>
<span class="fc bfc" id="L67" title="All 2 branches covered.">        message.maxPendingMessagesAcrossPartitions</span>
<span class="fc" id="L68">            ?.let { builder.maxPendingMessagesAcrossPartitions(message.maxPendingMessagesAcrossPartitions) }</span>
<span class="fc" id="L69">        return this</span>
    }

    /**
     * Build and return producer object
     */
    fun build(): PulsarProducer&lt;T&gt; {
<span class="fc" id="L76">        return PulsarProducer(</span>
<span class="fc" id="L77">            delegate = builder.create(),</span>
<span class="fc" id="L78">            autoFlush = autoFlush,</span>
<span class="fc" id="L79">            schema = schema</span>
        )
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>